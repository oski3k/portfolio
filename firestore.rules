rules_version = '2';

// ðŸ” Firestore Security Rules
// Te reguÅ‚y pozwalajÄ… niezalogowanym uÅ¼ytkownikom na ZAPIS wiadomoÅ›ci,
// ale NIE pozwalajÄ… na odczyt danych (maksymalna prywatnoÅ›Ä‡)

service cloud.firestore {
  match /databases/{database}/documents {
    
    // âœ… ReguÅ‚y dla kolekcji 'messages'
    match /messages/{messageId} {
      
      // âœ… ZEZWÃ“L NA ZAPIS (create) - kaÅ¼dy uÅ¼ytkownik moÅ¼e wysÅ‚aÄ‡ wiadomoÅ›Ä‡
      // Walidacja danych:
      // - Wymagane pola: name, email, subject, message, timestamp, read
      // - name: string, dÅ‚ugoÅ›Ä‡ 2-100 znakÃ³w
      // - email: string, dÅ‚ugoÅ›Ä‡ 5-100 znakÃ³w, zawiera '@'
      // - subject: string, dÅ‚ugoÅ›Ä‡ 3-200 znakÃ³w
      // - message: string, dÅ‚ugoÅ›Ä‡ 10-5000 znakÃ³w
      // - timestamp: timestamp (musi byÄ‡ serwerowy timestamp)
      // - read: boolean (domyÅ›lnie false)
      allow create: if request.resource.data.keys().hasAll(['name', 'email', 'subject', 'message', 'timestamp', 'read'])
                    && request.resource.data.name is string
                    && request.resource.data.name.size() >= 2
                    && request.resource.data.name.size() <= 100
                    && request.resource.data.email is string
                    && request.resource.data.email.size() >= 5
                    && request.resource.data.email.size() <= 100
                    && request.resource.data.email.matches('.*@.*')
                    && request.resource.data.subject is string
                    && request.resource.data.subject.size() >= 3
                    && request.resource.data.subject.size() <= 200
                    && request.resource.data.message is string
                    && request.resource.data.message.size() >= 10
                    && request.resource.data.message.size() <= 5000
                    && request.resource.data.timestamp is timestamp
                    && request.resource.data.read is bool
                    && request.resource.data.read == false;
      
      // âŒ ZAKAZ ODCZYTU - uÅ¼ytkownicy NIE mogÄ… czytaÄ‡ wiadomoÅ›ci
      // Tylko ty (jako wÅ‚aÅ›ciciel projektu) bÄ™dziesz mÃ³gÅ‚ je czytaÄ‡ przez Firebase Console
      allow read: if false;
      
      // âŒ ZAKAZ AKTUALIZACJI - uÅ¼ytkownicy NIE mogÄ… edytowaÄ‡ wiadomoÅ›ci
      allow update: if false;
      
      // âŒ ZAKAZ USUWANIA - uÅ¼ytkownicy NIE mogÄ… usuwaÄ‡ wiadomoÅ›ci
      allow delete: if false;
    }
    
    // âŒ ZAKAZ DOSTÄ˜PU DO INNYCH KOLEKCJI
    // Wszystkie inne kolekcje sÄ… domyÅ›lnie zablokowane
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

// ðŸ“ INSTRUKCJE WDROÅ»ENIA:
// 
// 1. Zaloguj siÄ™ do Firebase Console (https://console.firebase.google.com)
// 2. Wybierz swÃ³j projekt
// 3. W menu po lewej stronie kliknij "Firestore Database"
// 4. JeÅ›li to pierwsze uÅ¼ycie Firestore:
//    - Kliknij "Create database"
//    - Wybierz tryb "Start in production mode"
//    - Wybierz lokalizacjÄ™ (np. europe-west3 dla Polski)
// 5. Kliknij na zakÅ‚adkÄ™ "Rules" u gÃ³ry
// 6. Skopiuj i wklej CAÅÄ„ zawartoÅ›Ä‡ tego pliku do edytora reguÅ‚
// 7. Kliknij "Publish" aby zastosowaÄ‡ reguÅ‚y
//
// âš ï¸ WAÅ»NE UWAGI:
// - Te reguÅ‚y sÄ… bardzo restrykcyjne i bezpieczne
// - UÅ¼ytkownicy mogÄ… tylko DODAWAÄ† wiadomoÅ›ci, ale nie mogÄ… ich czytaÄ‡ ani modyfikowaÄ‡
// - Tylko administrator projektu (Ty) moÅ¼e czytaÄ‡ wiadomoÅ›ci przez Firebase Console
// - JeÅ›li chcesz czytaÄ‡ wiadomoÅ›ci z poziomu kodu (np. panel admina), 
//   musisz zaimplementowaÄ‡ Firebase Authentication i dodaÄ‡ odpowiednie reguÅ‚y
